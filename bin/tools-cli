#!/usr/bin/env php
<?php

$mainDir = __DIR__ . '/../';

require_once $mainDir . 'vendor/autoload.php';

use Symfony\Component\Console\Application;
use ToolsCli\Console\Commands;
use ToolsCli\Console\Alias;
use Benchmark\Performance\Timer;
use Symfony\Component\Console\Output\ConsoleOutput;

Timer::start();
$composer = json_decode(
    file_get_contents($mainDir . 'composer.json')
);

$alias = new Alias($argv);
$command = new Commands($alias);
$application = new Application;

$application->setAutoExit(false);
$application->setName($composer->description);
$application->setVersion($composer->version);
$application->addCommands($command->toArray());

$alias->setCommand($application, $command);

$code = $application->run();

$output = new ConsoleOutput();
//$output->setDecorated(true);
Timer::stop();

$data = Timer::calculateStats();

$output->writeln('');
$output->writeln(
    ' Total time:   <info>'
    . $data['total_rune_time']
    . ' ms</info>'
);
$output->writeln(
    ' Total memory: <info>'
    . number_format($data['total_memory'], 3)
    . ' kB</info>'
);
$output->write(' Code: ');
dump($code);
$output->writeln('');
